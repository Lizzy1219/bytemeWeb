<!DOCTYPE html>
<html lang="zh-tw">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding-top: 50px;
        }

        .image-container {
            position: relative;
            display: inline-block;
            max-width: 100%;
            width: 600px;
        }

        .image-container img {
            width: 100%;
            height: auto;
            border-radius: 5px;
        }

        .text-overlay {
            position: absolute;
            top: 10%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            color: white;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.7);
            font-weight: bold;
        }

        .option-container {
            position: absolute;
            top: 60%;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .answer-button {
            width: 200px;
            height: 50px;
            border-radius: 25px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
            background-color: rgba(128, 128, 128, 0.5);
            color: white;
            border: none;
            width: 60%;
        }

        .answer-button:hover {
            background-color: gray;
        }

        .retry-button {
            background-color: gray;
            color: white;
            font-size: 18px;
            padding: 15px 30px;
            border-radius: 30px;
            cursor: pointer;
            margin-top: 20px;
        }

        .retry-button:hover {
            background-color: black;
        }

        .result-container {
            margin-top: 30px;
        }

        .result-image {
            width: 50%;
            max-width: 300px;
        }
    </style>
</head>
<body>

    <div id="question-container"></div>

    <script>
        const resultImages = {
            "蛇": "images/snake.jpg",
            "兔子": "images/rabbit.jpg",
            "烏鴉": "images/crow.jpg",
            "貓": "images/cat.jpg",
            "羊": "images/sheep.jpg",
            "獅子": "images/lion.jpg",
            "馬": "images/horse.jpg",
            "狗": "images/dog.jpg"
        };

        const questions = [
            {
                question_id: "insert", // 特殊插圖頁面
                question: "",
                options: ["開始測驗"],
                image: "images/firstpage.JPG" // 替換為你的插圖路徑
            },
            {
                question_id: 0,
                question: " ",
                options: ["繼續"],
                image: "images/Q0.png"
            },
            {
                question_id: 1,
                question: " ",
                options: ["太可怕了吧！（退後幾步等待對方先開口）", "小心翼翼詢問這裡是哪裡", "和他握手並主動交談"],
                image: "images/Q1.png"
            },
            {
                question_id: 2,
                question: " ",
                options: ["好刺激！（馬上喝下去）", "告訴兔子你需要幾分鐘做心理準備", "先計畫一陣子，準備周全再答應"],
                image: "images/Q2.png"
            },
            {
                question_id: 3,
                question: " ",
                options: ["自己一個人的實驗", "跟一個未知的搭檔組隊", "一群人的團體實驗"],
                image: "images/Q3.png"
            },
            {
                question_id: 4,
                question: " ",
                options: ["覺得害怕和不適，感到心疼", "上前關心他是否受傷，並設法幫助他", "觀察四周，思考他是否是實驗的一部分"],
                image: "images/Q4.png"
            },
            {
                question_id: 5,
                question: " ",
                options: ["默默觀察對方，等他主動開口", "朝他微笑，以表達善意", "向他揮手並詢問他都發生了些什麼"],
                image: "images/Q5.png"
            },
            {
                question_id: 6,
                question: " ",
                options: ["先走再說，一邊觀察迷宮的環境", "在入口附近反覆查看，試圖破解迷宮", "先在起點搜索有用的物品"],
                image: "images/Q6.png"
            },
            {
                question_id: 7,
                question: " ",
                options: ["充滿神秘力量且閃閃發光的許願石", "能短暫增強夜視力的魔法藥水", "實用的武器小刀"],
                image: "images/Q7.png"
            },
            {
                question_id: 8,
                question: " ",
                options: ["自己一個人默默參與", "跟原本的搭檔結伴", "加入新的的團體群"],
                image: "images/Q8.png"
            },
            {
                question_id: 9,
                question: " ",
                options: ["照著自己所想如實回答", "跟一旁的人討論過後再決定選哪個", "跟隨多數人的決定選擇"],
                image: "images/Q9.png"
            },
            {
                question_id: 10,
                question: " ",
                options: ["暫時遠離他們，等其他人了解狀況", "跟著大家討論發生什麼事情", "觀察臉上的十字，並開始進行推理"],
                image: "images/Q10.png"
            },
            {
                question_id: 11,
                question: " ",
                options: ["參加這個實驗計畫是很有趣的回憶", "還好這次實驗沒有危及我的性命", "對這個實驗的目的充滿好奇"],
                image: "images/Q11.png"
            },
            {
                question_id: 12,
                question: " ",
                options: ["和其他參與者握手道別", "和他人討論起這次實驗的心得", "還想和其他人保持聯繫"],
                image: "images/Q12.png"
            }
        ];
        
        let currentQuestionIndex = 0;
        let answers = [];

        function loadQuestion() {
            const questionData = questions[currentQuestionIndex];
            const questionContainer = document.getElementById("question-container");

            // 特別處理 "insert" 的 question_id
            if (questionData.question_id === "insert") {
                questionContainer.innerHTML = `
                    <div class="image-container">
                        <img src="${questionData.image}" alt="插圖" />
                        <div class="option-container">
                            <button class="answer-button" onclick="nextQuestion()">開始測驗</button>
                        </div>
                    </div>
                `;
            } else {
                questionContainer.innerHTML = `
                    <div class="image-container">
                        <img src="${questionData.image}" alt="問題圖片" />
                        <div class="text-overlay">${questionData.question}</div>
                        <div class="option-container">
                            ${questionData.options.map((option, index) => {
                                return `
                                    <button class="answer-button" onclick="answerQuestion(${questionData.question_id}, ${index + 1})">
                                        ${option}
                                    </button>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            }
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
                loadQuestion();
            } else {
                submitAnswers();
            }
        }

        function answerQuestion(questionId, choice) {
            if (questionId > 0) {
                answers.push({
                    question_id: questionId,
                    choice: choice
                });
            }

            currentQuestionIndex++;

            if (currentQuestionIndex < questions.length) {
                loadQuestion();
            } else {
                submitAnswers();
            }
        }

        function submitAnswers() {
            console.log('Submitting answers:', answers);
            fetch('https://bytemeweb.000.pe/receive_data.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    user_id: Math.floor(Math.random() * 1000),
                    answers: answers
                }),
            })
            .then(response => response.json())
            .then(data => {
                showResult(data);
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        function showResult(result) {
            const questionContainer = document.getElementById("question-container");
            const resultImageUrl = resultImages[result.result]; 

            questionContainer.innerHTML = `
                <div class="result-container">
                    <img src="${resultImageUrl}" alt="結果圖片" class="result-image" />
                    <p>目前有${result.percentage}%相同結果</p>
                    <button class="retry-button" onclick="retryQuiz()">重測一次</button>
                </div>
            `;
        }

        function retryQuiz() {
            currentQuestionIndex = 0;
            answers = [];
            loadQuestion();
        }

        loadQuestion(); 
    </script>
</body>
</html>
